name: Get Citation Data

on: 
  page_build: 
  schedule:
    - cron:  '0 8 * * *'

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout Repository
      uses: actions/checkout@v2
      run: |
        echo "正在检出代码仓库..."
        
    - name: Install Requirements
      run: |
        echo "正在安装系统依赖..."
        sudo apt-get update
        sudo apt-get install -y python3-setuptools
        echo "系统依赖安装完成"
        
    - name: Setup Python Environment
      run: |
        echo "正在设置 Python 环境..."
        cd ./google_scholar_crawler
        echo "正在安装 Python 依赖..."
        pip install -r requirements.txt
        echo "Python 环境设置完成"
        
    - name: Run Crawler
      run: |
        echo "正在运行爬虫程序..."
        python main.py
        echo "爬虫程序运行完成"
        
    - name: Commit and Push Results
      run: |
        echo "正在准备提交结果..."
        cd ./results
        git init
        git config --local user.name "${GITHUB_ACTOR}"
        export remote_repo="https://${GITHUB_ACTOR}:${{ secrets.GITHUB_TOKEN }}@github.com/${GITHUB_REPOSITORY}.git"
        echo "正在添加文件..."
        git add *.json
        echo "正在提交更改..."
        git commit -m "Updated Citation Data"
        echo "正在推送更改..."
        git push "${remote_repo}" HEAD:google-scholar-stats --force
        echo "结果已成功推送"
      env: 
        GOOGLE_SCHOLAR_ID: ${{ secrets.GOOGLE_SCHOLAR_ID }}


# name: Get Citation Data

# on: 
#  page_build: 
#  schedule:
#   - cron:  '0 8 * * *'

# jobs:
#  build:
#    runs-on: ubuntu-latest
#    steps:
#    - uses: actions/checkout@v2
#    - name: Install Reqs
#      run: |
#        sudo apt-get install python3-setuptools
#    - name: Run
#      run: |
#        cd ./google_scholar_crawler
#        pip install -r requirements.txt
#        python main.py
#        cd ./results
#        git init
#        git config --local user.name "${GITHUB_ACTOR}"
#        export remote_repo="https://${GITHUB_ACTOR}:${{ secrets.GITHUB_TOKEN }}@github.com/${GITHUB_REPOSITORY}.git"
#        git add *.json
#        git commit -m "Updated Citation Data"
#        git push "${remote_repo}" HEAD:google-scholar-stats --force
#      env: 
#        GOOGLE_SCHOLAR_ID: ${{ secrets.GOOGLE_SCHOLAR_ID }}
