name: Get Citation Data

on:
  page_build:
  schedule:
    - cron: '0 8 * * *'

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2

    - name: Install Reqs
      run: |
        echo "Installing required packages..."
        sudo apt-get install python3-setuptools
        echo "Installation complete."

    - name: Run
      run: |
        echo "Changing directory to ./google_scholar_crawler"
        cd ./google_scholar_crawler
        echo "Installing dependencies..."
        pip install -r requirements.txt
        echo "Dependencies installed."

        echo "Running main.py..."
        python main.py
        echo "Python script execution complete."

        echo "Changing directory to ./results"
        cd ./results
        
        echo "Initializing git repository..."
        git init
        echo "Git repository initialized."

        echo "Configuring git user..."
        git config --local user.name "${GITHUB_ACTOR}"
        echo "Git user configured."

        echo "Setting remote repository..."
        export remote_repo="https://${GITHUB_ACTOR}:${{ secrets.GITHUB_TOKEN }}@github.com/${GITHUB_REPOSITORY}.git"
        echo "Remote repository set."

        echo "Adding files to git..."
        git add *.json
        echo "Files added to git."

        echo "Committing changes..."
        git commit -m "Updated Citation Data"
        echo "Changes committed."

        echo "Pushing to remote repository..."
        git push "${remote_repo}" HEAD:google-scholar-stats --force
        echo "Push complete."

      env:
        GOOGLE_SCHOLAR_ID: ${{ secrets.GOOGLE_SCHOLAR_ID }}


















# name: Get Citation Data

# on: 
#  page_build: 
#  schedule:
#   - cron:  '0 8 * * *'

# jobs:
#  build:
#    runs-on: ubuntu-latest
#    steps:
#    - uses: actions/checkout@v2
#    - name: Install Reqs
#      run: |
#        sudo apt-get install python3-setuptools
#    - name: Run
#      run: |
#        cd ./google_scholar_crawler
#        pip install -r requirements.txt
#        python main.py
#        cd ./results
#        git init
#        git config --local user.name "${GITHUB_ACTOR}"
#        export remote_repo="https://${GITHUB_ACTOR}:${{ secrets.GITHUB_TOKEN }}@github.com/${GITHUB_REPOSITORY}.git"
#        git add *.json
#        git commit -m "Updated Citation Data"
#        git push "${remote_repo}" HEAD:google-scholar-stats --force
#      env: 
#        GOOGLE_SCHOLAR_ID: ${{ secrets.GOOGLE_SCHOLAR_ID }}
